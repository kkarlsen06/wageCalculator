---
description:
globs:
alwaysApply: false
---
RULESET: PLACEHOLDER_EMPLOYEES_V1

1) Employees are manager-owned placeholders, not real logins.
   - employees.manager_id = auth.uid()
   - email is metadata only.
2) Shifts belong to the manager; employee_id is just a tag.
   - user_shifts.user_id = auth.uid()
   - user_shifts.employee_id FK -> employees.id ON DELETE SET NULL
3) Never create or link auth.users from employees.
4) Respect RLS; mirror ownership checks in middleware; deny cross-tenant ids.
5) Archiving a placeholder hides it but preserves history.
6) Avatars:
   - Bucket = 'employee-avatars' (private).
   - Only use server-signed upload/read URLs.
7) Break policy (default): fixed_0_5_over_5_5h
   - If duration > 5.5h, deduct 0.5h.
   - Do not auto-deduct from the highest-paid period by default.
8) Mobile-first UX; carousel + modals must be smooth and accessible.
9) Backwards compatibility: flows without employee_id must keep working.
10) No Storage policy DDL. If needed, rely on signed URLs only.


Use employee_shifts for placeholder employees; user_shifts stays for the manager’s own shifts.
AI chatbot (agent) is read-only for employee_shifts (no create/update/delete).
Employees can have a tariff (lønnstrinn); calculations prefer tariff rate, else fallback to employee.hourly_wage.