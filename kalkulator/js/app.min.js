function setAppHeight(){const h=window.visualViewport ? window.visualViewport.height : window.innerHeight;document.documentElement.style.setProperty('--app-height',h+'px');}setAppHeight();window.addEventListener('resize',setAppHeight);if(window.visualViewport){window.visualViewport.addEventListener('resize',setAppHeight);}document.addEventListener('DOMContentLoaded',async()=>{const supa=window.supabase.createClient(window.CONFIG.supabase.url,window.CONFIG.supabase.anonKey);window.supa=supa;let session=null;let retryCount=0;const maxRetries=5;async function showWelcomeScreen(){const{data:{user}}=await supa.auth.getUser();const firstName=user?.user_metadata?.first_name||'';const welcomeScreen=document.createElement('div');welcomeScreen.id='welcomeScreen';const welcomeContainer=document.createElement('div');welcomeContainer.className='welcome-container';welcomeScreen.appendChild(welcomeContainer);document.body.appendChild(welcomeScreen);const heiLine=document.createElement('div');heiLine.className='welcome-line';heiLine.id='heiLine';welcomeContainer.appendChild(heiLine);const nameLine=document.createElement('div');nameLine.className='welcome-line name-line';nameLine.id='nameLine';welcomeContainer.appendChild(nameLine);const heiText='Hei';const heiLetters=[...heiText].map((char,i)=>{const span=document.createElement('span');span.className='letter';span.textContent=char;heiLine.appendChild(span);return span;});let nameLetters=[];if(firstName){const nameParts=firstName.trim().split(' ');if(nameParts.length>1){nameParts.forEach((part,partIndex)=>{const partSpan=document.createElement('span');partSpan.className='name-part';[...part].forEach((char,charIndex)=>{const span=document.createElement('span');span.className='letter';span.textContent=char;partSpan.appendChild(span);nameLetters.push(span);});nameLine.appendChild(partSpan);if(partIndex<nameParts.length-1){const spaceSpan=document.createElement('span');spaceSpan.className='letter name-space';spaceSpan.textContent='\u00A0';nameLine.appendChild(spaceSpan);nameLetters.push(spaceSpan);}});}else{[...firstName].forEach((char,i)=>{const span=document.createElement('span');span.className='letter';span.textContent=char;nameLine.appendChild(span);nameLetters.push(span);});}}const allLetters=[...heiLetters,...nameLetters];allLetters.forEach((span,i)=>{span.style.animation=`letter-in 0.5s forwards ${i*0.1}s`;});const inDuration=500+allLetters.length*100;await new Promise(res=>setTimeout(res,inDuration+100));welcomeContainer.style.transformOrigin='center center';welcomeContainer.style.animation=`text-out 0.5s forwards`;await new Promise(res=>setTimeout(res,800));welcomeScreen.remove();}function animateAppEntries(){const container=document.querySelector('.app-container');if(!container)return;const children=Array.from(container.children);children.forEach((el,idx)=>{el.style.opacity='0';el.style.animation=`fadeInDown 0.6s forwards ${idx*0.1}s`;});}while(!session&&retryCount<maxRetries){`);const{data:{session: currentSession}}=await supa.auth.getSession();session=currentSession;if(!session){retryCount++;if(retryCount<maxRetries){await new Promise(resolve=>setTimeout(resolve,200));}else{window.location.href='./';return;}}else{}}window.logout=async()=>{await supa.auth.signOut();window.location.href='./';};const{app}=await import('./appLogic.js?v=5');window.app=app;await showWelcomeScreen();await app.init();const appEl=document.getElementById('app');if(appEl){appEl.style.display='block';animateAppEntries();}document.querySelectorAll('[onclick]').forEach(el=>{const onClick=el.getAttribute('onclick');if(onClick){el.addEventListener('click',(event)=>{try{if(onClick.includes('app.')){const match=onClick.match(/app\.(\w+)\((.*?)\)/);if(match){const [,functionName,params]=match;let parsedParams=[];if(params.trim()){if(params.includes("'")||params.includes('"')){parsedParams=[params.replace(/['"]/g,'')];}else if(params.includes('event.stopPropagation()')){event.stopPropagation();const indexMatch=onClick.match(/app\.deleteShift\((\d+)\)/);if(indexMatch){app.deleteShift(parseInt(indexMatch[1]));return;}}else if(params.includes('this')){parsedParams=[el];}else if(params.match(/^\d+$/)){parsedParams=[parseInt(params)];}}if(app[functionName]){app[functionName](...parsedParams);}}}else if(onClick.includes('logout()')){logout();}}catch(error){}});el.setAttribute('onclick','return false;');}});let eventListenersAdded=false;function addEventListeners(){if(eventListenersAdded)return;document.body.addEventListener('click',(event)=>{if(event.target.closest('.delete-shift-btn')||event.target.closest('.edit-shift-btn')||event.target.closest('.btn')){return;}const shiftItem=event.target.closest('[data-shift-id]');if(shiftItem){const shiftId=shiftItem.getAttribute('data-shift-id');app.showShiftDetails(shiftId);}});document.body.addEventListener('click',(event)=>{const deleteBtn=event.target.closest('.delete-shift-btn');if(deleteBtn){event.stopPropagation();const shiftIndex=parseInt(deleteBtn.getAttribute('data-shift-index'));app.deleteShift(shiftIndex).then(()=>{app.closeShiftDetails();});}});document.body.addEventListener('click',(event)=>{const editBtn=event.target.closest('.edit-shift-btn');if(editBtn){event.stopPropagation();const shiftId=editBtn.getAttribute('data-shift-id');app.editShift(shiftId);}});eventListenersAdded=true;document.body.addEventListener('click',(event)=>{const closeBtn=event.target.closest('.close-shift-details');if(closeBtn){event.stopPropagation();app.closeShiftDetails();}});document.body.addEventListener('click',(event)=>{const modal=event.target.closest('.modal');if(modal&&event.target===modal){if(modal.id==='addShiftModal'){app.closeAddShiftModal();}else if(modal.id==='editShiftModal'){app.closeEditShift();}else if(modal.id==='settingsModal'){app.closeSettings();}else if(modal.id==='breakdownModal'){app.closeBreakdown();}}});document.addEventListener('keydown',(event)=>{if(event.key==='Escape'){if(document.getElementById('addShiftModal').style.display==='block'){app.closeAddShiftModal();}else if(document.getElementById('editShiftModal').style.display==='block'){app.closeEditShift();}else if(document.getElementById('settingsModal').style.display==='block'){app.closeSettings();}else if(document.getElementById('breakdownModal').style.display==='block'){app.closeBreakdown();}}});document.body.addEventListener('click',(event)=>{const removeBtn=event.target.closest('.remove-bonus');if(removeBtn){event.stopPropagation();app.removeBonusSlot(removeBtn);}});}addEventListeners();const snapContainer=document.querySelector('.snap-container');const floatingBar=document.querySelector('.floating-action-bar');const shiftSection=document.querySelector('.shift-section');if(snapContainer&&floatingBar&&shiftSection){floatingBar.style.display='none';floatingBar.style.opacity='0';let isVisible=false;let animationTimeout=null;function checkFloatingBarVisibility(){const rect=shiftSection.getBoundingClientRect();const viewportHeight=window.innerHeight;const threshold=0.8;const shouldBeVisible=rect.top<viewportHeight*threshold&&rect.bottom>viewportHeight*0.1;if(shouldBeVisible&&!isVisible){isVisible=true;clearTimeout(animationTimeout);floatingBar.style.display='flex';floatingBar.style.animation='fadeInUp 0.3s ease-out forwards';floatingBar.style.opacity='1';}else if(!shouldBeVisible&&isVisible){isVisible=false;clearTimeout(animationTimeout);floatingBar.style.animation='fadeOutDown 0.3s ease-out forwards';floatingBar.style.opacity='0';animationTimeout=setTimeout(()=>{if(!isVisible){floatingBar.style.display='none';}},300);}}snapContainer.addEventListener('scroll',checkFloatingBarVisibility);checkFloatingBarVisibility();}});