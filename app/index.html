<!DOCTYPE html>
<html lang="nb-NO">
<head>
  <meta charset="UTF-8">
  <title>Interaktiv lønnskalkulator for Norge – riktig lønn hver måned | kalkulator.kkarlsen.dev</title>
  <meta name="description" content="Regn ut lønn, overtid, tillegg og pauser. Lagre vakter og få riktig fasit hver måned. Gratis å starte.">
  <link rel="canonical" href="https://kalkulator.kkarlsen.dev/" />
  <meta name="robots" content="index,follow" />
  <meta http-equiv="content-language" content="nb-NO" />
  <link rel="alternate" hreflang="nb-NO" href="https://kalkulator.kkarlsen.dev/" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <!-- Google Fonts - Inter for modern, professional typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- External preconnects disabled for local development
  <link rel="preconnect" href="https://id.kkarlsen.dev" crossorigin>
  <link rel="dns-prefetch" href="https://server.kkarlsen.dev"> -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="src/css/themes.css">
  <link rel="stylesheet" href="src/css/style.css">
  <link rel="stylesheet" href="src/css/chat.css">
  <link rel="stylesheet" href="src/css/settings.css">
  <!-- Route/feature CSS is now code-split and loaded on demand -->
  <!-- Favicons for THIS host (must live on kalkulator.* origin too) -->
  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/favicon-48x48.png" sizes="48x48" />
  <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#111111" />
  <link rel="manifest" href="/webmanifest.json">
  <meta name="theme-color" content="#111111">
  <!-- Open Graph / Twitter (app) -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Interaktiv lønnskalkulator for Norge – riktig lønn hver måned" />
  <meta property="og:description" content="Regn ut lønn, overtid, tillegg og pauser. Lagre vakter og få riktig fasit hver måned. Gratis å starte." />
  <meta property="og:url" content="https://kalkulator.kkarlsen.dev/" />
  <meta property="og:image" content="https://kalkulator.kkarlsen.dev/og/kalkulator.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Interaktiv lønnskalkulator for Norge – riktig lønn hver måned" />
  <meta name="twitter:description" content="Regn ut lønn, overtid, tillegg og pauser. Lagre vakter og få riktig fasit hver måned. Gratis å starte." />
  <meta name="twitter:image" content="https://kalkulator.kkarlsen.dev/og/kalkulator.png" />
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"Lønnskalkulator",
    "applicationCategory":"BusinessApplication",
    "operatingSystem":"Web",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"NOK"},
    "url":"https://kalkulator.kkarlsen.dev/"
  }</script>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Lønnskalkulator">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="msapplication-navbutton-color" content="#111111">
  <meta name="msapplication-TileColor" content="#111111">
  <!-- Web app manifest for PWA installation and iOS safe area handling -->
</head>
<body>
    <!-- SPA auth pages mount here; hidden while in main app route -->
    <div id="spa-root" style="display:none"></div>

    <!-- Hoved-appen skjules til bruker er innlogget -->
    <div id="app" style="display:none">
      <!-- Snap container for full-screen sections -->
      <div class="snap-container">

          <!-- Dashboard Section -->
          <section class="snap-section dashboard-section" role="main" aria-label="Dashboard">
            <main id="main-content">
              <div class="app-container">
                  <div class="header">
                      <div class="header-top">
                          <div class="header-left">
                              <a href="https://www.kkarlsen.dev" class="header-logo-link">
                                  <img src="/icons/kkarlsen_ikon_clean.png" class="header-logo" alt="kkarlsen logo">
                              </a>
                          </div>
                          <div class="header-right">
                                <div class="user-profile-container">
                                    <button class="user-profile-btn" onclick="app.toggleProfileDropdown()" aria-label="Åpne brukerprofil">
                                        <span class="user-nickname" id="userNickname">Bruker</span>
                                         <img id="userAvatarImg" class="topbar-avatar" alt="Profilbilde" style="display:none;" />
                                        <svg class="icon-sm profile-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="12" cy="7" r="4"></circle>
                                        </svg>
                                    </button>
                                     <!-- Skeleton placeholder for profile while loading -->
                                     <div class="profile-skeleton" aria-hidden="true">
                                         <div class="skeleton-avatar"></div>
                                         <div class="skeleton-line w-40"></div>
                                     </div>
                                    <div class="profile-dropdown" id="profileDropdown" style="display: none;">
                                        <div class="dropdown-item" data-spa data-href="/settings">
                                            <span>Innstillinger</span>
                                        </div>
                                        <div class="dropdown-item" onclick="app.openSubscription()">
                                            <span>Abonnement</span>
                                        </div>
                                        <div class="dropdown-item logout-item" onclick="app.handleLogout()">
                                            <span>Logg ut</span>
                                        </div>
                                    </div>
                                </div>
                          </div>
                      </div>
                  </div>

                  <!-- Tab Bar Navigation - positioned above all content -->
                  <div class="tab-bar-container">
                      <div class="tab-bar">
                          <button class="tab-btn active" id="tabOversikt" data-view="dashboard" aria-label="Bytt til oversiktsvisning">
                              <div class="tab-icon-badge">
                                  <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                      <rect x="3" y="3" width="7" height="7"></rect>
                                      <rect x="14" y="3" width="7" height="7"></rect>
                                      <rect x="14" y="14" width="7" height="7"></rect>
                                      <rect x="3" y="14" width="7" height="7"></rect>
                                  </svg>
                              </div>
                              <span class="tab-text">Oversikt</span>
                          </button>
                          <button class="tab-btn" id="tabStatistikk" data-view="stats" aria-label="Bytt til statistikkvisning">
                              <div class="tab-icon-badge">
                                  <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                      <line x1="18" y1="20" x2="18" y2="10"></line>
                                      <line x1="12" y1="20" x2="12" y2="4"></line>
                                      <line x1="6" y1="20" x2="6" y2="14"></line>
                                  </svg>
                              </div>
                              <span class="tab-text">Statistikk</span>
                          </button>
                          <button class="tab-btn" id="tabLonnAI" data-view="chatgpt" aria-label="Bytt til LønnAI chatbot">
                              <div class="tab-icon-badge">
                                  <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                      <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423L16.5 15.75l.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"></path>
                              </svg>
                              </div>
                              <span class="tab-text">LønnAI</span>
                          </button>
                          <button class="tab-btn" id="tabAnsatte" data-view="employees" aria-label="Bytt til ansattvisning" style="display: none;">
                              <div class="tab-icon-badge">
                                  <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                      <circle cx="9" cy="7" r="4"></circle>
                                      <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                      <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                  </svg>
                              </div>
                              <span class="tab-text">Ansatte</span>
                          </button>
                      </div>
                      <!-- Skeleton placeholder for tab bar while loading -->
                      <div class="tab-bar-skeleton" aria-hidden="true">
                          <div class="skeleton-block"></div>
                          <div class="skeleton-block"></div>
                          <div class="skeleton-block"></div>
                      </div>
                  </div>

                  <div class="content dashboard-content">
                      <div class="total-card">
                          <div class="total-label">Brutto</div>
                          <div class="total-amount" id="totalAmount">0 kr</div>
                          <div class="total-secondary-info" id="totalSecondaryInfo">
                              <!-- Will be populated based on tax deduction setting -->
                          </div>
                          <!-- Skeleton placeholder for total card while loading -->
                          <div class="total-skeleton skeleton" aria-hidden="true">
                              <div class="skeleton-line"></div>
                              <div class="skeleton-line"></div>
                              <div class="skeleton-line"></div>
                          </div>
                      </div>

                      <div class="next-shift-card" id="nextShiftCard">
                          <div class="next-shift-content" id="nextShiftContent">
                              <!-- Skeleton placeholder for next shift -->
                              <div class="skeleton skeleton-shift">
                                <div class="skeleton-line w-60"></div>
                                <div class="skeleton-line w-40"></div>
                              </div>
                          </div>
                          <div class="next-shift-empty" id="nextShiftEmpty" style="display: none;">
                          </div>
                      </div>

                      <div class="next-payroll-card" id="nextPayrollCard">
                          <div class="next-payroll-content" id="nextPayrollContent">
                              <!-- Skeleton placeholder for payroll -->
                              <div class="skeleton skeleton-payroll">
                                <div class="skeleton-line w-50"></div>
                                <div class="skeleton-line w-30"></div>
                              </div>
                          </div>
                          <div class="next-payroll-empty" id="nextPayrollEmpty" style="display: none;">
                          </div>
                      </div>

                      <!-- Chat Bot Section - Now managed by tab bar -->
                      <section id="chatbox" class="chatbox-container" style="display: none;">
                          <div class="chatbox-pill" id="chatboxPill">
                              <!-- Always visible pill header -->
                              <div class="chatbox-pill-content">
                                  <!-- Icon badge container -->
                                  <div class="chatbox-icon-badge">
                                      <svg class="chatbox-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                          <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423L16.5 15.75l.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"></path>
                                      </svg>
                                  </div>
                                  <div class="chatbox-pill-text-container">
                                      <span class="chatbox-pill-text" id="chatboxPillPlaceholder">Trenger du hjelp, Bruker?...</span>
                                      <div class="connection-status" id="connectionStatus" style="display: none;">
                                          <div class="connection-indicator" id="connectionIndicator"></div>
                                          <span class="connection-text" id="connectionText">Connecting...</span>
                                      </div>
                                  </div>
                                  <button class="chatbox-new-chat" id="chatboxNewChat" aria-label="Ny chat" style="display: none;">
                                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                          <line x1="12" y1="5" x2="12" y2="19"></line>
                                          <line x1="5" y1="12" x2="19" y2="12"></line>
                                      </svg>
                                  </button>
                                  <button class="chatbox-close" id="chatboxClose" aria-label="Lukk chat" style="display: none;">
                                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                          <line x1="18" y1="6" x2="6" y2="18"></line>
                                          <line x1="6" y1="6" x2="18" y2="18"></line>
                                      </svg>
                                  </button>
                              </div>

                              <!-- Expanded content (shown after first message) -->
                              <div class="chatbox-expanded-content" id="chatboxExpandedContent" style="display: none;">
                                  <div class="chatbox-log" id="chatboxLog">
                                      <!-- Chat messages will be populated here -->
                                  </div>
                                  <div class="chatbox-input-container">
                                      <textarea id="chatboxInput" class="chatbox-input" placeholder="Skriv en melding..." rows="1"></textarea>
                                      <button id="chatboxSend" class="chatbox-send-btn" aria-label="Send melding">
                                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                              <line x1="22" y1="2" x2="11" y2="13"></line>
                                              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                          </svg>
                                      </button>
                                  </div>
                              </div>
                          </div>
                      </section>

                      <!-- Month Navigation - positioned directly underneath tab bar -->
                      <!-- This navigation stays in dashboard section across all screen sizes -->
                      <div class="month-navigation-container dashboard-month-nav">
                          <div class="month-navigation">
                              <button class="month-nav-btn" onclick="app.navigateToPreviousMonth()" aria-label="Forrige måned">
                                  <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                      <polyline points="15 18 9 12 15 6"></polyline>
                                  </svg>
                              </button>
                              <span class="month-display" id="currentMonthDashboard">Mai 2025</span>
                              <!-- Month picker skeleton removed - will be hidden during loading -->
                              <button class="month-nav-btn" onclick="app.navigateToNextMonth()" aria-label="Neste måned">
                                  <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                      <polyline points="9 6 15 12 9 18"></polyline>
                                  </svg>
                              </button>
                          </div>
                      </div>





                  </div>
              </div>
             </main>
          </section>

          <!-- Statistics Section -->
          <section class="snap-section statistics-section" role="complementary" aria-label="Statistikk">
              <div class="app-container">
                  <div class="statistics-content">
                      <div class="weekly-hours-chart-card" id="weeklyHoursChart">
                          <div class="chart-cards-container">
                              <!-- Bar Chart Card -->
                              <div class="chart-visualization-card">
                                  <div class="chart-container">
                                      <div class="chart-content">
                                          <div class="chart-bars" id="chartBars">
                                              <!-- Bars will be populated dynamically -->
                                          </div>
                                      </div>
                                      <div class="chart-labels" id="chartLabels">
                                          <!-- Week labels will be populated dynamically -->
                                      </div>
                                  </div>
                                  <div class="chart-tooltip" id="chartTooltip">
                                      <span id="tooltipContent"></span>
                                  </div>
                              </div>

                              <!-- Hours Section - Two Stacked Cards -->
                              <div class="chart-hours-section">
                                  <!-- Total Hours Card -->
                                  <div class="chart-hours-value-card">
                                      <div class="hours-value-content">
                                          <div class="hours-value-number" id="totalHours">0</div>
                                          <div class="hours-value-label">timer</div>
                                      </div>
                                  </div>

                                  <!-- Shift Count Card -->
                                  <div class="chart-shifts-count-card">
                                      <div class="shifts-count-content">
                                          <div class="shifts-count-number" id="shiftCount">0</div>
                                          <div class="shifts-count-label">vakter</div>
                                      </div>
                                  </div>

                                  <!-- Custom tooltip for wage cards -->
                                  <div class="wage-card-tooltip" id="wageCardTooltip">
                                      <span id="wageTooltipContent"></span>
                                  </div>
                              </div>
                          </div>

                          <!-- Progress bar positioned below both cards -->
                          <div class="chart-progress-bar" title="Månedlig mål fremdrift">
                              <div class="chart-progress-fill loading" style="width: 0%"></div>
                              <span class="chart-progress-label">0 % av 0 kr</span>
                          </div>
                      </div>
                  </div>
              </div>
          </section>

      </div> <!-- slutt på .snap-container -->



      <!-- Settings Modal -->
      <div id="settingsModalLegacy" class="modal" style="display:none">
          <div class="modal-content"><!-- legacy settings modal content moved to /settings route -->
              <div class="modal-header">
                  <h2 class="modal-title">Innstillinger</h2>
                  <button type="button" class="modal-close" onclick="app.closeSettings()" aria-label="Lukk">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <line x1="18" y1="6" x2="6" y2="18"></line>
                          <line x1="6" y1="6" x2="18" y2="18"></line>
                      </svg>
                  </button>
              </div>
                <div class="tab-nav">
                    <button class="tab-btn active" data-tab="wage" onclick="app.switchSettingsTabSync('wage')">
                        <svg class="icon-sm tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        Min lønn
                    </button>
                    <button class="tab-btn" data-tab="interface" onclick="app.switchSettingsTabSync('interface')">
                        <svg class="icon-sm tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                            <line x1="8" y1="21" x2="16" y2="21"></line>
                            <line x1="12" y1="17" x2="12" y2="21"></line>
                        </svg>
                        Utseende
                    </button>
                    <button class="tab-btn" data-tab="org" onclick="app.switchSettingsTabSync('org')">
                        <svg class="icon-sm tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 21h18"></path>
                            <path d="M5 21V7l8-4v18"></path>
                            <path d="M19 21V11l-6-4"></path>
                        </svg>
                        Bedrift
                    </button>
                    <button class="tab-btn" data-tab="data" onclick="app.switchSettingsTabSync('data')">
                        <svg class="icon-sm tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Data
                    </button>
                </div>

              <div class="tab-content-wrapper">
                  <div id="wageTabLegacy" class="tab-content active">
                      <div class="settings-section-header">
                          <h3>Lønnsberegning</h3>
                          <p class="section-description">Sett opp hvordan lønnen din skal beregnes</p>
                      </div>

                  <div class="form-group">
                      <div class="flex justify-between align-center mb-10">
                          <label>Lønnsmodell</label>
                          <span id="presetBadge" class="preset-badge" style="display: none;">Virke-tariff</span>
                      </div>
                      <div class="switch-group">
                          <div>
                              <span class="text-secondary">Bruk Virke-tariff</span>
                              <small class="form-hint">Automatisk beregning basert på offisiell lønnsavtale</small>
                          </div>
                          <label class="switch">
                              <input type="checkbox" id="usePresetToggle" checked onchange="app.togglePreset()">
                              <span class="slider"></span>
                          </label>
                      </div>
                  </div>

                  <div id="presetWageSection" class="settings-subsection">
                      <div class="form-group settings-level-2">
                          <label>Velg ditt lønnstrinn</label>
                          <select class="form-control" id="wageSelect" onchange="app.updateWageLevel(this.value)">
                              <option value="-1">Under 16 år - 129,91 kr/time</option>
                              <option value="-2">Under 18 år - 132,90 kr/time</option>
                              <option value="1" selected>Trinn 1 - 184,54 kr/time</option>
                              <option value="2">Trinn 2 - 185,38 kr/time</option>
                              <option value="3">Trinn 3 - 187,46 kr/time</option>
                              <option value="4">Trinn 4 - 193,05 kr/time</option>
                              <option value="5">Trinn 5 - 210,81 kr/time</option>
                              <option value="6">Trinn 6 - 256,14 kr/time</option>
                          </select>
                          <small class="form-hint">Basert på Virke-tariff 2025. Velg trinnet som passer din erfaring.</small>
                      </div>
                  </div>

                  <div id="customWageSection" class="settings-subsection" style="display: none;">
                      <div class="form-group settings-level-2">
                          <label>Din timelønn</label>
                          <input type="number" class="form-control" id="customWageInput" placeholder="200" step="0.01" onchange="app.updateCustomWage(this.value)">
                          <small class="form-hint">Skriv inn din timelønn i kroner</small>
                      </div>

                      <!-- Collapsible bonus settings -->
                      <div class="form-group settings-level-2">
                          <button type="button" class="settings-collapse-toggle" data-toggle-section="bonusWageSettings" aria-expanded="false">
                              <svg class="collapse-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                  <polyline points="6 9 12 15 18 9"></polyline>
                              </svg>
                              <span>Tillegg for ulike tider</span>
                          </button>
                          
                          <div class="settings-collapsible-content" id="bonusWageSettings" style="display: none;">
                              <div class="form-group settings-level-3">
                                  <label>Ukedager (man–fre)</label>
                                  <div class="bonus-slots" id="weekdayBonusSlots">
                                      <!-- Dynamisk innhold -->
                                  </div>
                                  <button class="btn btn-secondary" onclick="app.addBonusSlot('weekday')">+ Legg til tidsperiode</button>
                              </div>

                              <div class="form-group settings-level-3">
                                  <label>Lørdag</label>
                                  <div class="bonus-slots" id="saturdayBonusSlots">
                                      <!-- Dynamisk innhold -->
                                  </div>
                                  <button class="btn btn-secondary" onclick="app.addBonusSlot('saturday')">+ Legg til tidsperiode</button>
                              </div>

                              <div class="form-group settings-level-3">
                                  <label>Søndag/helligdag</label>
                                  <div class="bonus-slots" id="sundayBonusSlots">
                                      <!-- Dynamisk innhold -->
                                  </div>
                                  <button class="btn btn-secondary" onclick="app.addBonusSlot('sunday')">+ Legg til tidsperiode</button>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- Break Deduction Settings Section -->
                  <div class="form-group form-group-with-hint">
                      <div class="settings-section-divider">
                          <h4>Pauser og trekk</h4>
                      </div>

                      <!-- Enable/Disable Break Deduction -->
                      <div class="switch-group">
                        <div>
                          <span class="text-secondary">Trekk pause fra lønnen</span>
                          <small class="form-hint">Automatisk trekk for ubetalt pause på lange vakter</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="pauseDeductionEnabledToggle" checked>
                            <span class="slider"></span>
                        </label>
                      </div>

                      <!-- Sub-settings for break deduction (level 2) -->
                      <div class="settings-subsection" id="breakDeductionSubsection">
                          <!-- Break Deduction Method -->
                          <div class="form-group settings-level-2">
                            <label for="pauseDeductionMethodSelect">Metode</label>
                            <select id="pauseDeductionMethodSelect" class="form-control">
                              <option value="proportional">Proporsjonal (anbefalt)</option>
                              <option value="base_only">Kun grunnlønn</option>
                              <option value="end_of_shift">Slutt av vakt (legacy)</option>
                            </select>
                            <small class="form-hint">Velg hvordan pausetrekk skal beregnes</small>
                          </div>

                          <!-- Collapsible Advanced Settings -->
                          <div class="form-group settings-level-2">
                              <button type="button" class="settings-collapse-toggle" data-toggle-section="advancedBreakSettings" aria-expanded="false">
                                  <svg class="collapse-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                      <polyline points="6 9 12 15 18 9"></polyline>
                                  </svg>
                                  <span>Avansert</span>
                              </button>
                              
                              <div class="settings-collapsible-content" id="advancedBreakSettings" style="display: none;">
                                  <!-- Method Explanation -->
                                  <div class="form-group settings-level-3" id="methodExplanation">
                                    <div class="method-info">
                                      <div id="proportionalInfo" class="method-description">
                                        <strong>Proporsjonalt:</strong> Trekkes fra alle timer. Anbefalt.
                                      </div>
                                      <div id="baseOnlyInfo" class="method-description" style="display: none;">
                                        <strong>Kun grunnlønn:</strong> Trekk kun fra grunnlønn. Tillegg bevares.
                                      </div>
                                      <div id="endOfShiftInfo" class="method-description" style="display: none;">
                                        <strong>⚠️ Slutt av vakt:</strong> Trekker på slutten. Kan være problematisk.
                                      </div>
                                      <div id="noneInfo" class="method-description" style="display: none;">
                                        <strong>Ingen trekk:</strong> Pause betales.
                                      </div>
                                    </div>
                                  </div>

                                  <div class="form-group settings-level-3" id="pauseThresholdSection">
                                    <label for="pauseThresholdInput">Terskel (timer)</label>
                                    <input type="number" id="pauseThresholdInput" class="form-control" min="0" max="24" step="0.5" value="5.5">
                                    <small class="form-hint">Min. vaktlengde for trekk</small>
                                  </div>

                                  <div class="form-group settings-level-3" id="pauseDeductionMinutesSection">
                                    <label for="pauseDeductionMinutesInput">Trekk (minutter)</label>
                                    <input type="number" id="pauseDeductionMinutesInput" class="form-control" min="0" max="120" step="15" value="30">
                                    <small class="form-hint">Antall minutter i trekk</small>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>

                  <div class="form-group form-group-with-hint">
                      <div class="settings-section-divider">
                          <h4>Mål og oversikt</h4>
                      </div>
                      <label for="monthlyGoalInput">Månedlig inntektsmål</label>
                      <div class="switch-group">
                          <input type="number" id="monthlyGoalInput" class="form-control" min="0" step="100" style="max-width:140px;display:inline-block;" placeholder="20000">
                          <button class="btn btn-secondary" id="saveMonthlyGoalBtn" style="margin-left:8px;">Lagre</button>
                      </div>
                      <small class="form-hint">Hvor mye ønsker du å tjene per måned? Vises som fremdrift i oversikten.</small>
                  </div>

                  <div class="form-group form-group-with-hint">
                      <label>Skatteberegning</label>
                      <div class="switch-group">
                        <div>
                          <span class="text-secondary">Vis lønn etter skatt</span>
                          <small class="form-hint">Se hvor mye du får utbetalt etter skattetrekk</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="taxDeductionToggle" onchange="app.toggleTaxDeduction()">
                            <span class="slider"></span>
                        </label>
                      </div>
                      
                      <!-- Tax percentage sub-setting -->
                      <div class="form-group settings-level-2" id="taxPercentageSection" style="display: none;">
                          <label for="taxPercentageInput">Din skatteprosent</label>
                          <div class="switch-group">
                              <input type="number" id="taxPercentageInput" class="form-control" min="0" max="100" step="0.1" style="max-width:140px;display:inline-block;" placeholder="25.0" onchange="app.updateTaxPercentage(this.value)">
                              <span class="text-secondary" style="margin-left:8px;">%</span>
                          </div>
                          <small class="form-hint">Vanligvis mellom 20-35%. Sjekk skattekortet ditt for eksakt prosent.</small>
                      </div>
                  </div>

                  <div class="form-group form-group-with-hint">
                      <label for="payrollDayInput">Lønningsdag</label>
                      <div class="switch-group">
                          <input type="number" id="payrollDayInput" class="form-control" min="1" max="31" step="1" style="max-width:140px;display:inline-block;" placeholder="15" onchange="app.updatePayrollDay(this.value)">
                      </div>
                      <small class="form-hint">Hvilken dag får du utbetalt lønn? Brukes for å vise neste lønningsdag.</small>
                  </div>
              </div>

                  <div id="orgTabLegacy" class="tab-content">
                      <!-- Enterprise content (visible when user has Enterprise subscription) -->
                      <div id="orgEnterpriseContent" style="display:none;">
                          <div class="settings-section-header">
                              <h3>Bedriftsinnstillinger</h3>
                              <p class="section-description">Innstillinger som påvirker alle ansatte i bedriften</p>
                          </div>

                          <!-- Policy Settings -->
                          <div class="form-group settings-level-2">
                              <label for="breakPolicySelect">Pausepolicy for ansatte</label>
                              <select id="breakPolicySelect" class="form-control">
                                  <option value="proportional_across_periods">Proporsjonal trekk (anbefalt)</option>
                                  <option value="from_base_rate">Trekk kun fra grunnlønn</option>
                                  <option value="fixed_0_5_over_5_5h">Trekk på slutten av vakt</option>
                                  <option value="none">Ingen trekk - betalt pause</option>
                              </select>
                              <small class="form-hint">Hvordan skal pause trekkes fra lønnen for alle ansatte? Påvirker rapporter og oversikter.</small>
                          </div>

                          <!-- Data Management -->
                          <div class="form-group form-group-with-hint" style="margin-top: 32px;">
                              <div class="settings-section-divider">
                                  <h4>Rapporter og eksport</h4>
                              </div>
                          </div>

                          <div class="form-group settings-level-2">
                              <label>Lønnsrapporter</label>
                              <div style="margin-top: 10px;">
                                  <button type="button" class="btn btn-primary" onclick="app.openCsvExportModal()">
                                      <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                          <polyline points="7 10 12 15 17 10"></polyline>
                                          <line x1="12" y1="15" x2="12" y2="3"></line>
                                      </svg>
                                      Eksporter lønnsrapport
                                  </button>
                              </div>
                              <small class="form-hint">Last ned detaljert lønnsrapport for alle ansatte som CSV-fil</small>
                          </div>
                      </div>

                      <!-- Upsell content (visible when user does NOT have Enterprise subscription) -->
                      <div id="orgUpsellContent">
                          <div class="settings-section-header">
                              <h3>Bedrift</h3>
                              <p class="section-description">Lås opp bedriftsfunksjoner med Enterprise</p>
                          </div>

                          <div class="form-group settings-level-2" style="text-align: left;">
                              <p style="margin: 0 0 12px 0;">
                                  Bedriftsinnstillinger som felles pausepolicy, avanserte rapporter og administrasjon er tilgjengelig i Enterprise.
                              </p>
                              <small class="form-hint">Oppgrader for å konfigurere bedriftspolicy og få flere eksportmuligheter.</small>
                          </div>

                          <div class="form-group" style="margin-top: 16px;">
                              <button type="button" class="btn btn-primary" onclick="app.openSubscription()">
                                  <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                      <path d="M20 6L9 17l-5-5"></path>
                                  </svg>
                                  Oppgrader til Enterprise
                              </button>
                          </div>
                      </div>
                  </div>

              <div id="interfaceTabLegacy" class="tab-content">
                  <div class="settings-section-header">
                      <h3>Utseende og oppførsel</h3>
                      <p class="section-description">Tilpass appen etter dine preferanser</p>
                  </div>
                  
                  <div class="form-group settings-level-2">
                      <label>Fargetema</label>
                      <div class="theme-selector">
                          <div class="theme-options">
                              <label class="theme-option">
                                  <input type="radio" name="theme" value="light" id="themeLight">
                                  <div class="theme-preview theme-preview-light">
                                      <div class="theme-preview-header"></div>
                                      <div class="theme-preview-content"></div>
                                  </div>
                                  <span>Lys</span>
                              </label>
                              <label class="theme-option">
                                  <input type="radio" name="theme" value="dark" id="themeDark">
                                  <div class="theme-preview theme-preview-dark">
                                      <div class="theme-preview-header"></div>
                                      <div class="theme-preview-content"></div>
                                  </div>
                                  <span>Mørk</span>
                              </label>
                              <label class="theme-option">
                                  <input type="radio" name="theme" value="system" id="themeSystem" checked>
                                  <div class="theme-preview theme-preview-system">
                                      <div class="theme-preview-header"></div>
                                      <div class="theme-preview-content"></div>
                                  </div>
                                  <span>Automatisk</span>
                              </label>
                          </div>
                      </div>
                      <small class="form-hint">Velg lyst eller mørkt tema, eller la appen følge systeminnstillingene</small>
                  </div>

                  <div class="form-group settings-level-2">
                      <label>Vaktvisning</label>
                      <div class="switch-group">
                        <div>
                          <span class="text-secondary">Åpne kalender først</span>
                          <small class="form-hint">Vis kalender i stedet for liste når du åpner vaktene</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="defaultShiftsViewToggle">
                            <span class="slider"></span>
                        </label>
                      </div>
                  </div>

                  <!-- Enterprise-only: Employees tab visibility -->
                  <div class="form-group settings-level-2" id="employeeTabVisibilityGroup" style="display: none;">
                      <label>Navigasjon</label>
                      <div class="switch-group">
                        <div>
                          <span class="text-secondary">Vis "Ansatte"-fanen</span>
                          <small class="form-hint">Skjul Ansatte-fanen selv om du har Enterprise. Fint for de som vil støtte, men ikke bruker ansattfunksjonene.</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="showEmployeeTabToggle">
                            <span class="slider"></span>
                        </label>
                      </div>
                  </div>

                  <!-- Input & Formatting Settings -->
                  <div class="form-group form-group-with-hint" style="margin-top: 32px;">
                      <div class="settings-section-divider">
                          <h4>Registrering og format</h4>
                      </div>
                  </div>

                  <div class="form-group settings-level-2">
                      <label>Tidsregistrering</label>
                      <div class="switch-group">
                        <div>
                          <span class="text-secondary">Skriv tid direkte</span>
                          <small class="form-hint">Raskere registrering uten dropdown-menyer (for erfarne brukere)</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="directTimeInputToggle">
                            <span class="slider"></span>
                        </label>
                      </div>
                      
                      <!-- Collapsible time format details -->
                      <div class="settings-subsection" id="timeInputSubsection">
                          <div class="form-group settings-level-3">
                              <button type="button" class="settings-collapse-toggle" data-toggle-section="timeFormatSettings" aria-expanded="false">
                                  <svg class="collapse-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                      <polyline points="6 9 12 15 18 9"></polyline>
                                  </svg>
                                  <span>Avanserte tidsinnstillinger</span>
                              </button>
                              
                              <div class="settings-collapsible-content" id="timeFormatSettings" style="display: none;">
                                  <div class="form-group settings-level-4">
                                      <label>Minutt-presisjon</label>
                                      <div class="switch-group">
                                        <div>
                                          <span class="text-secondary">Vis alle minutter</span>
                                          <small class="form-hint">Vis hvert minutt i stedet for 15-minutters intervaller</small>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" id="fullMinuteRangeToggle">
                                            <span class="slider"></span>
                                        </label>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>

                  <div class="form-group settings-level-2">
                      <label>Valutaformat</label>
                      <div class="switch-group">
                        <div>
                          <span class="text-secondary">Bruk "NOK" i stedet for "kr"</span>
                          <small class="form-hint">Mer formell fremstilling i rapporter og eksport</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="currencyFormatToggle">
                            <span class="slider"></span>
                        </label>
                      </div>
                  </div>
              </div>



              <div id="dataTabLegacy" class="tab-content">
                  <div class="settings-section-header">
                      <h3>Data og backup</h3>
                      <p class="section-description">Eksporter data for regnskap eller sikkerhetskopi</p>
                  </div>
                  
                  <div id="exportOptionsSection" class="settings-level-2">
                      <div class="form-group">
                          <label>Velg periode å eksportere</label>
                          <div class="export-period-options">
                              <label class="radio-option">
                                  <input type="radio" name="exportPeriod" value="current">
                                  <span id="currentMonthLabel">Denne måneden</span>
                              </label>
                              <label class="radio-option">
                                  <input type="radio" name="exportPeriod" value="year">
                                  <span>Hele året (alle 12 måneder)</span>
                              </label>
                              <label class="radio-option">
                                  <input type="radio" name="exportPeriod" value="all">
                                  <span>Alle vakter jeg har registrert</span>
                              </label>
                              <label class="radio-option">
                                  <input type="radio" name="exportPeriod" value="custom">
                                  <span>Velg datoer selv</span>
                              </label>
                          </div>
                      </div>

                      <div id="customPeriodSection" class="form-group settings-level-3" style="display: none;">
                          <label class="custom-period-header">Velg datoer</label>
                          <small class="form-hint">Fra hvilken dato til hvilken dato?</small>
                          <div class="form-row">
                              <input type="date" id="exportStartDate" class="form-control" style="margin-right: 8px;" placeholder="Fra dato">
                              <input type="date" id="exportEndDate" class="form-control" placeholder="Til dato">
                          </div>
                      </div>

                      <div class="form-group">
                          <label>Last ned som:</label>
                          <div class="export-buttons-container">
                              <button class="btn btn-primary" onclick="app.exportDataWithPeriod('csv')">
                                  <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                      <polyline points="14 2 14 8 20 8"></polyline>
                                      <line x1="16" y1="13" x2="8" y2="13"></line>
                                      <line x1="16" y1="17" x2="8" y2="17"></line>
                                  </svg>
                                  CSV (Excel)
                              </button>
                              <button class="btn btn-secondary" onclick="app.exportDataWithPeriod('pdf')">
                                  <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                      <polyline points="14 2 14 8 20 8"></polyline>
                                      <line x1="16" y1="13" x2="8" y2="13"></line>
                                      <line x1="16" y1="17" x2="8" y2="17"></line>
                                  </svg>
                                  PDF-rapport
                              </button>
                          </div>
                          <small class="form-hint">CSV kan åpnes i Excel. PDF er ferdig formatert rapport.</small>
                      </div>
                  </div>

                  <!-- Import Section -->
                  <div class="form-group form-group-with-hint" style="margin-top: 32px;">
                      <div class="settings-section-divider">
                          <h4>Importer vakter</h4>
                      </div>
                      <small class="form-hint">Last opp vaktdata fra andre systemer eller sikkerhetskopier</small>
                  </div>
                  
                  <div class="form-group settings-level-2">
                      <label>Velg fil å importere</label>
                      <div class="form-row">
                          <input type="file" id="importFileData" class="form-control" accept=".csv,.json" style="margin-right: 8px;">
                          <button class="btn btn-secondary" onclick="app.importDataFromDataTab()">
                              <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                  <polyline points="17 10 12 5 7 10"></polyline>
                                  <line x1="12" y1="15" x2="12" y2="5"></line>
                              </svg>
                              Last opp
                          </button>
                      </div>
                      <small class="form-hint">Støtter CSV- og JSON-filer. Vakter blir lagt til de du allerede har.</small>
                  </div>
              </div>
              </div>

              <!-- Fixed bottom close button for settings modal -->
              <div class="modal-fixed-footer">
                  <button class="btn btn-secondary modal-close-bottom" onclick="app.closeSettings()">
                      <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <line x1="18" y1="6" x2="6" y2="18"></line>
                          <line x1="6" y1="6" x2="18" y2="18"></line>
                      </svg>
                  </button>
              </div>
          --></div>
      </div>

      <!-- Profile Modal -->
      <div id="profileModalLegacy" class="modal" style="display:none">
          <div class="modal-content">
              <div class="modal-header">
                  <h2 class="modal-title">Min profil</h2>
              </div>
              <div class="modal-body">
                  <form id="profile-form-legacy" novalidate>
                      <div class="form-group form-group-with-hint">
                          <label for="profileNameLegacy">Fornavn</label>
                          <input type="text" id="profileNameLegacy" name="given-name" class="form-control" placeholder="Fornavn" autocomplete="given-name">
                          <small class="form-hint">Vises i velkomstskjermen og rapporter</small>
                      </div>

                      <div class="form-group form-group-with-hint">
                          <label for="profileEmailLegacy">E-post</label>
                          <input type="email" id="profileEmailLegacy" name="email" class="form-control" placeholder="E-post" disabled autocomplete="email">
                          <small class="form-hint">E-postadressen kan ikke endres etter registrering</small>
                      </div>

                       <!-- Profile picture upload -->
                       <div class="form-group form-group-with-hint avatar-section">
                           <label>Profilbilde</label>
                           <div class="avatar-upload-container">
                               <div class="avatar-preview" id="profileAvatarPreviewLegacy" style="width: 96px; height: 96px; border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border);">
                                   <img id="profileAvatarImageLegacy" alt="Forhåndsvisning" style="width:100%; height:100%; object-fit: cover; display: none;" />
                                   <div id="profileAvatarPlaceholderLegacy" class="avatar-placeholder" aria-hidden="true">
                                       <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                           <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                           <circle cx="12" cy="7" r="4"></circle>
                                       </svg>
                                   </div>
                               </div>
                               <div class="avatar-upload-controls" style="display:flex; gap: 8px; align-items: center;">
                                   <input type="file" id="profileAvatarInputLegacy" accept="image/*" style="display:none;" />
                                   <button type="button" class="btn btn-secondary avatar-upload-btn" id="profileAvatarChooseBtnLegacy">Velg bilde</button>
                                   <button type="button" class="btn btn-danger avatar-remove-btn" id="profileAvatarRemoveBtnLegacy">Fjern</button>
                               </div>
                               <div id="profilePictureProgressLegacy" style="display:none; width: 100%; max-width: 260px; border: 1px solid var(--border); border-radius: 8px; overflow: hidden;">
                                   <div id="profilePictureProgressFillLegacy" style="height: 8px; width: 0%; background: var(--accent);"></div>
                                   <div id="profilePictureProgressTextLegacy" style="font-size: 12px; padding: 6px 8px; color: var(--text-secondary);">Laster opp...</div>
                               </div>
                           </div>
                           <small class="form-hint">Last opp et kvadratisk bilde. Du kan beskjære før lagring.</small>
                       </div>

      <!-- Crop Modal for avatar -->
      <div id="cropModalLegacy" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 420px; width: 92vw;">
              <div class="modal-header">
                  <h2 class="modal-title">Juster profilbilde</h2>
              </div>
              <div class="modal-body">
                  <div style="width:100%; max-height: 48vh; display:flex; align-items:center; justify-content:center;">
                      <div style="width: 280px; height: 280px; border-radius: 50%; overflow: hidden; background: var(--bg-secondary); display:flex; align-items:center; justify-content:center;">
                          <img id="cropImage" class="crop-image" alt="Beskjær bilde" style="max-width:100%; display:block;" />
                      </div>
                  </div>
                  <div style="display:flex; align-items:center; gap:8px; margin-top: 8px;">
                      <button type="button" id="zoomOutBtn" class="btn btn-secondary zoom-btn" aria-label="Zoom ut" style="min-width:40px; width:40px; height:40px; border-radius:50%;">−</button>
                      <input id="cropZoomSlider" class="zoom-slider" type="range" min="0.5" max="3" step="0.01" value="1" style="flex:1;" />
                      <button type="button" id="zoomInBtn" class="btn btn-secondary zoom-btn" aria-label="Zoom inn" style="min-width:40px; width:40px; height:40px; border-radius:50%;">+</button>
                  </div>
                  <small class="form-hint" style="display:block; margin-top:6px; text-align:center;">Dra for å flytte. Klyp eller bruk zoom-knappene.</small>
              </div>
              <div class="modal-fixed-footer">
                  <div class="modal-bottom-actions" style="display:flex; gap:8px;">
                      <button type="button" class="btn btn-primary" id="confirmCropBtn">Lagre</button>
                      <button type="button" class="btn btn-secondary modal-close-bottom" id="cancelCropBtn">Avbryt</button>
                  </div>
              </div>
          </div>
      </div>


                  </form>

                  <p id="profile-update-msg-legacy" style="color: var(--success); min-height: 24px; text-align: center; font-size: 14px;"></p>

                      <div class="form-group form-group-with-hint" style="border-top: 1px solid var(--border); padding-top: 20px; margin-top: 20px;">
                      <label>Kontotilkoblinger</label>
                      <div id="google-linking-row-legacy" class="form-row" style="margin-bottom: 16px; display:flex; align-items:center; gap:8px;">
                          <button id="btn-link-google-legacy" type="button" class="btn btn-secondary" style="display: flex; align-items: center; gap: 8px;">
                            <svg aria-hidden="true" width="16" height="16" viewBox="0 0 48 48">
                              <path d="M44.5 20H24v8.5h11.8C34.6 33.9 29.9 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 3.1l6-6C34.6 4.3 29.6 2 24 2 12.4 2 3 11.4 3 23s9.4 21 21 21 20-9.4 20-21c0-1.2-.1-2.1-.3-3z" fill="#FFC107"/>
                              <path d="M6.3 14.7l7 5.1C14.7 16.3 18.9 13 24 13c3.1 0 5.9 1.1 8.1 3.1l6-6C34.6 4.3 29.6 2 24 2 15.5 2 8.2 6.7 6.3 14.7z" fill="#FF3D00"/>
                              <path d="M24 44c5.7 0 10.6-1.9 14.1-5.2l-6.5-5.4c-2 1.4-4.6 2.2-7.6 2.2-5.9 0-10.8-3.9-12.6-9.3l-7.1 5.5C7.2 38.8 15 44 24 44z" fill="#4CAF50"/>
                              <path d="M44.5 20H24v8.5h11.8c-1 2.9-3 5.2-5.6 6.9l6.5 5.4C39.8 42.5 45 38 45 23c0-1.2-.2-2.1-.5-3z" fill="#1976D2"/>
                            </svg>
                            Koble til Google
                          </button>
                          <button id="btn-unlink-google-legacy" type="button" class="btn btn-danger" style="display:none; align-items: center; gap: 8px;">
                            Fjern Google-konto
                          </button>
                          <span id="google-unlink-warning" class="form-hint" style="display:none; color: #FBBF24; font-size: 12px;">
                            Du må ha et annet innloggingsalternativ før du kan fjerne Google.
                          </span>
                      </div>
                      <small class="form-hint">Koble Google-kontoen din for enklere innlogging</small>
                  </div>

                  <div class="form-group form-group-with-hint">
                      <label>Kontoadministrasjon</label>
                      <div class="form-row">
                          <button class="btn btn-primary" onclick="app.restartOnboarding()" style="margin-right: 8px;">
                              <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                  <path d="M1 4v6h6"></path>
                                  <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                              </svg>
                              Start onboarding på nytt
                          </button>
                          <button class="btn btn-danger" onclick="app.clearAllShifts()">
                              <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                  <path d="M3 6h18"></path>
                                  <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                  <path d="M8 6V4c0-1 1-2 2-2h4c0 1 1 2 2 2v2"></path>
                                  <line x1="10" y1="11" x2="10" y2="17"></line>
                                  <line x1="14" y1="11" x2="14" y2="17"></line>
                              </svg>
                              Slett alle vakter
                          </button>
                      </div>
                      <small class="form-hint">Permanent fjerning av alle vakter eller starte onboarding på nytt</small>
                  </div>
              </div>

              <!-- Fixed bottom close button for profile modal -->
              <div class="modal-fixed-footer">
                  <button class="btn btn-secondary" onclick="logout()" style="margin-right: auto;">
                      <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                          <polyline points="16 17 21 12 16 7"></polyline>
                          <line x1="21" y1="12" x2="9" y2="12"></line>
                      </svg>
                      Logg ut
                  </button>
                  <button class="btn btn-secondary modal-close-bottom" onclick="app.closeProfile()">
                      <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <line x1="18" y1="6" x2="6" y2="18"></line>
                          <line x1="6" y1="6" x2="18" y2="18"></line>
                      </svg>
                  </button>
              </div>
          </div>
      </div>



      <!-- Cropping modal removed -->

      <!-- CSV Export Modal -->
      <div id="csvExportModal" class="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h2 class="modal-title">Eksporter lønnsrapport</h2>
                  <button type="button" class="modal-close" onclick="app.closeCsvExportModal()" aria-label="Lukk">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <line x1="18" y1="6" x2="6" y2="18"></line>
                          <line x1="6" y1="6" x2="18" y2="18"></line>
                      </svg>
                  </button>
              </div>

              <div class="modal-body">
                  <form id="csvExportForm">
                      <div class="form-group">
                          <label for="csvExportEmployeeSelect">Ansatt</label>
                          <select class="form-control" id="csvExportEmployeeSelect">
                              <option value="">Alle ansatte</option>
                              <!-- Employee options will be populated dynamically -->
                          </select>
                      </div>

                      <div class="form-group">
                          <label for="csvExportFromDate">Fra dato</label>
                          <input type="date" class="form-control" id="csvExportFromDate" />
                      </div>

                      <div class="form-group">
                          <label for="csvExportToDate">Til dato</label>
                          <input type="date" class="form-control" id="csvExportToDate" />
                      </div>

                      <div class="info-box">
                          <div class="info-content">
                              <strong>Info:</strong> Rapporten inkluderer alle lønnsdata med beregninger basert på registrerte vakter og gjeldende pausetrekk-policy.
                          </div>
                      </div>
                  </form>

                  <div class="modal-button-group" style="margin-top: 24px;">
                      <button type="button" class="btn btn-primary" onclick="app.exportCsvReport()">
                          <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                              <polyline points="7 10 12 15 17 10"></polyline>
                              <line x1="12" y1="15" x2="12" y2="3"></line>
                          </svg>
                          Last ned CSV
                      </button>
                      <button type="button" class="btn btn-secondary" onclick="app.closeCsvExportModal()">
                          Avbryt
                      </button>
                  </div>
              </div>
          </div>
      </div>
      <!-- End of CSV Export Modal -->

    </div>  <!-- slutt på #app -->

    <!-- Bottom Navigation Bar - positioned outside #app so it's always visible -->
    <nav class="bottom-nav">
        <button class="nav-item" onclick="window.navigateToRoute('/')">
            <div class="nav-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 17.0002V11.4522C20 10.9179 19.9995 10.6506 19.9346 10.4019C19.877 10.1816 19.7825 9.97307 19.6546 9.78464C19.5102 9.57201 19.3096 9.39569 18.9074 9.04383L14.1074 4.84383C13.3608 4.19054 12.9875 3.86406 12.5674 3.73982C12.1972 3.63035 11.8026 3.63035 11.4324 3.73982C11.0126 3.86397 10.6398 4.19014 9.89436 4.84244L5.09277 9.04383C4.69064 9.39569 4.49004 9.57201 4.3457 9.78464C4.21779 9.97307 4.12255 10.1816 4.06497 10.4019C4 10.6506 4 10.9179 4 11.4522V17.0002C4 17.932 4 18.3978 4.15224 18.7654C4.35523 19.2554 4.74432 19.6452 5.23438 19.8482C5.60192 20.0005 6.06786 20.0005 6.99974 20.0005C7.93163 20.0005 8.39808 20.0005 8.76562 19.8482C9.25568 19.6452 9.64467 19.2555 9.84766 18.7654C9.9999 18.3979 10 17.932 10 17.0001V16.0001C10 14.8955 10.8954 14.0001 12 14.0001C13.1046 14.0001 14 14.8955 14 16.0001V17.0001C14 17.932 14 18.3979 14.1522 18.7654C14.3552 19.2555 14.7443 19.6452 15.2344 19.8482C15.6019 20.0005 16.0679 20.0005 16.9997 20.0005C17.9316 20.0005 18.3981 20.0005 18.7656 19.8482C19.2557 19.6452 19.6447 19.2554 19.8477 18.7654C19.9999 18.3978 20 17.932 20 17.0002Z" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <span class="nav-label">Hjem</span>
        </button>

        <button class="nav-item" data-spa data-href="/shifts">
            <div class="nav-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2.75" y="5.75" width="18.5" height="12.5" rx="3"/>
                    <path d="M7 9.5h10"/>
                    <path d="M7 12h10"/>
                    <path d="M7 14.5h8"/>
                </svg>
            </div>
            <span class="nav-label">Vakter</span>
        </button>

        <button class="nav-item nav-add" data-spa data-href="/shift-add">
            <div class="nav-icon-add">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="16"></line>
                    <line x1="8" y1="12" x2="16" y2="12"></line>
                </svg>
            </div>
        </button>

        <button class="nav-item" data-route="chat">
            <div class="nav-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
            </div>
            <span class="nav-label">Chat</span>
        </button>

        <button class="nav-item" data-route="settings">
            <div class="nav-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </div>
            <span class="nav-label">Innstillinger</span>
        </button>
</nav>





    <!-- Vite kalkulator entry -->
    <script type="module" src="/src/kalkulator.js"></script>
</body>
</html>
