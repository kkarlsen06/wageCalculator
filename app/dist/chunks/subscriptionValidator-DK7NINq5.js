import{s as i}from"./supabase-client-C25D-rrn.js";import{g as l}from"../kalkulator-C0Bilr8I.js";import"./modulepreload-polyfill-B5Qt9EMX.js";import"./bootstrap-supa-C1PZRnWu.js";import"./runtime-config-D7xitdne.js";import"./apiBase-C8RWFuli.js";import"./error-handling-BcaxJS6j.js";async function w(s){try{const t=await l();if(!t)return{canCreate:!1,reason:"authentication_required",requiresUpgrade:!1};const{data:r,error:a}=await i.from("profiles").select("before_paywall").eq("id",t).single();a&&console.warn("[paywall] Could not fetch profile:",a);const{data:n,error:e}=await i.from("subscription_tiers").select("status, is_active").eq("user_id",t).maybeSingle();e&&e.code!=="PGRST116"&&(console.warn("[paywall] Could not fetch subscription:",e),console.warn("[paywall] Defaulting to free tier validation due to subscription query error"));const o=n?.is_active===!0,u=r?.before_paywall===!0;return o?{canCreate:!0,reason:null,requiresUpgrade:!1}:u?{canCreate:!0,reason:null,requiresUpgrade:!1}:await c(t,s)}catch(t){return console.error("[paywall] Validation error:",t),{canCreate:!1,reason:"system_error",requiresUpgrade:!1}}}async function c(s,t){try{const r=t.substring(0,7),{data:a,error:n}=await i.from("user_shifts").select("shift_date").eq("user_id",s);if(n)return console.warn("[paywall] Could not fetch existing shifts:",n),{canCreate:!1,reason:"system_error",requiresUpgrade:!1};if(!a||a.length===0)return{canCreate:!0,reason:null,requiresUpgrade:!1};const e=new Set(a.map(o=>o.shift_date.substring(0,7)));return e.size===1&&e.has(r)?{canCreate:!0,reason:null,requiresUpgrade:!1}:!e.has(r)&&e.size>0?{canCreate:!1,reason:"free_tier_month_limit",requiresUpgrade:!0,otherMonths:Array.from(e).filter(o=>o!==r)}:e.has(r)&&e.size>1?{canCreate:!1,reason:"free_tier_month_limit",requiresUpgrade:!0,otherMonths:Array.from(e).filter(o=>o!==r)}:{canCreate:!0,reason:null,requiresUpgrade:!1}}catch(r){return console.error("[paywall] Free month limit check error:",r),{canCreate:!1,reason:"system_error",requiresUpgrade:!1}}}async function y(s){try{if(!await l())return{success:!1,deletedCount:0,error:"authentication_required"};const{data:{session:r}}=await i.auth.getSession();if(!r)return{success:!1,deletedCount:0,error:"authentication_required"};const a=await fetch(`${window.CONFIG.apiBase}/shifts/outside-month/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${r.access_token}`,"Content-Type":"application/json"}});if(!a.ok){const e=await a.json().catch(()=>({}));return console.error("[paywall] Delete shifts API error:",e),{success:!1,deletedCount:0,error:"delete_failed"}}const n=await a.json();return{success:n.success,deletedCount:n.deletedCount||0,error:null}}catch(t){return console.error("[paywall] Delete shifts exception:",t),{success:!1,deletedCount:0,error:"system_error"}}}function C(s){switch(s.reason){case"authentication_required":return"Du må være logget inn for å legge til vakter.";case"free_tier_month_limit":return"Du har funnet en premium-funksjon. Gratis-planen tillater kun vakter i én måned om gangen.";case"system_error":return"Systemfeil. Prøv igjen senere.";default:return"Kunne ikke validere vakt-oppretting."}}export{y as deleteShiftsOutsideMonth,C as getValidationMessage,w as validateShiftCreation};
